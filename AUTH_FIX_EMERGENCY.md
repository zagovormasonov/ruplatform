# üö® –°–†–û–ß–ù–û–ï –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–ò

## üéØ **–ü–†–û–ë–õ–ï–ú–ê: –í–•–û–î –ò –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –ù–ï –†–ê–ë–û–¢–ê–Æ–¢**

## ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:**

### **1. –£–ø—Ä–æ—â–µ–Ω–∞ middleware –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:**
```typescript
// –£–±—Ä–∞–Ω–æ –ª–∏—à–Ω–µ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
// –û—Å—Ç–∞–≤–ª–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
export const authenticateToken = async (req: AuthRequest, res: Response, next: NextFunction) => {
  const authHeader = req.headers['authorization'];
  const token = authHeader && authHeader.split(' ')[1];

  if (!token) {
    return res.status(401).json({ error: '–¢–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω' });
  }

  try {
    const JWT_SECRET = process.env.JWT_SECRET || 'spiritual_masters_platform_jwt_secret_key_2024';
    const decoded = jwt.verify(token, JWT_SECRET) as any;

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –ë–î
    const userResult = await pool.query(
      'SELECT id, email, role FROM users WHERE id = $1',
      [decoded.id]
    );

    if (userResult.rows.length === 0) {
      return res.status(401).json({ error: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω' });
    }

    req.user = userResult.rows[0];
    next();
  } catch (error) {
    console.error('Spiritual Platform: –û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:', error);
    return res.status(403).json({ error: '–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω' });
  }
};
```

### **2. –£–±—Ä–∞–Ω–æ –ª–∏—à–Ω–µ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- ‚úÖ –£–±—Ä–∞–Ω–æ –∏–∑ –≤—Å–µ—Ö —Ä–æ—É—Ç–æ–≤
- ‚úÖ –û—Å—Ç–∞–≤–ª–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
- ‚úÖ –ù–µ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞

## üö® **–ù–ï–ú–ï–î–õ–ï–ù–ù–û –û–ë–ù–û–í–ò–¢–ï –°–ï–†–í–ï–†:**

### **1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
```bash
# –õ–æ–∫–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞:
scp -r server/dist/* root@31.130.155.103:/home/node/ruplatform/server/dist/
scp -r client/dist/* root@31.130.155.103:/home/node/ruplatform/client/dist/
```

### **2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:**
```bash
ssh root@31.130.155.103 "pm2 restart ruplatform"
```

### **3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å:**
```bash
ssh root@31.130.155.103 "pm2 logs ruplatform --lines 10"
```

## üîç **–ü–†–û–í–ï–†–¨–¢–ï –†–ê–ë–û–¢–£:**

### **1. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏:**
**URL:** http://31.130.155.103/login

### **2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è:**
**URL:** http://31.130.155.103/register

### **3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞:**
- ‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 200 OK –ø—Ä–∏ –≤—Ö–æ–¥–µ/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ –î–æ–ª–∂–µ–Ω –ø—Ä–∏–π—Ç–∏ JWT —Ç–æ–∫–µ–Ω
- ‚úÖ –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—è

## üéØ **–ß–¢–û –°–õ–û–ú–ê–õ–û –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Æ:**

### **–ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ —è –∏—Å–ø—Ä–∞–≤–∏–ª:**
1. **–õ–∏—à–Ω–µ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–µ—Ä–µ–≥—Ä—É–∂–∞–ª–æ —Å–µ—Ä–≤–µ—Ä
2. **–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ console.log** - –º–æ–≥–ª–æ –≤—ã–∑–≤–∞—Ç—å –æ—à–∏–±–∫–∏
3. **–°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ middleware** - –º–æ–≥–ª–∞ —Å–ª–æ–º–∞—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é

### **–¢–µ–ø–µ—Ä—å:**
- ‚úÖ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —É–ø—Ä–æ—â–µ–Ω–∞
- ‚úÖ –¢–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

## üö® **–ö–†–ò–¢–ò–ß–ù–û:**

**–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞ –≤—Ö–æ–¥ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å!**

**–ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ JWT_SECRET** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö** - –µ—Å—Ç—å –ª–∏ —Ç–∞–±–ª–∏—Ü–∞ users
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î**

**–ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø –¢–ï–ü–ï–†–¨ –î–û–õ–ñ–ù–ê –†–ê–ë–û–¢–ê–¢–¨! üîê‚ú®**
