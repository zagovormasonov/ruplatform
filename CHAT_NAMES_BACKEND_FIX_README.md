# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –ò–ú–ï–ù –í –ß–ê–¢–ï (BACKEND)

## ‚ùå –ü–†–û–ë–õ–ï–ú–ê
–í —á–∞—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∏–º–µ–Ω–∞ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–æ–≤:
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å undefined" –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω—ã—Ö –∏–º–µ–Ω
- SQL –∑–∞–ø—Ä–æ—Å—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç NULL –ø—Ä–∏ –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–∏ —Å –ø—É—Å—Ç—ã–º–∏ –∏–º–µ–Ω–∞–º–∏
- API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–º–µ–Ω

## ‚úÖ –†–ï–®–ï–ù–ò–ï
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã SQL –∑–∞–ø—Ä–æ—Å—ã –≤ backend API –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ NULL –∑–Ω–∞—á–µ–Ω–∏–π –∏–º–µ–Ω.

## üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –í chats.ts

### 1. –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ (GET /chats)
```sql
-- –î–û:
WHEN c.user1_id = $1 THEN u2.first_name || ' ' || u2.last_name

-- –ü–û–°–õ–ï:
WHEN c.user1_id = $1 THEN COALESCE(u2.first_name, '') || ' ' || COALESCE(u2.last_name, '')
```

### 2. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–∞—Ç–µ (GET /chats/:id)
```sql
-- –î–û:
WHEN c.user1_id = $1 THEN u2.first_name || ' ' || u2.last_name

-- –ü–û–°–õ–ï:
WHEN c.user1_id = $1 THEN COALESCE(u2.first_name, '') || ' ' || COALESCE(u2.last_name, '')
```

## üéØ –ß–¢–û –ò–°–ü–†–ê–í–õ–ï–ù–û

### ‚úÖ **SQL –∑–∞–ø—Ä–æ—Å—ã —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç NULL:**
- `COALESCE(u2.first_name, '')` - –∑–∞–º–µ–Ω—è–µ—Ç NULL –Ω–∞ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
- –ö–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è `'' || ' ' || ''` –¥–∞–µ—Ç `' '` –≤–º–µ—Å—Ç–æ `NULL`
- API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∏–º–µ–Ω–∞ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–æ–≤

### ‚úÖ **Frontend fallback:**
- –ï—Å–ª–∏ `otherUserName` –≤—Å–µ —Ä–∞–≤–Ω–æ –ø—É—Å—Ç–æ–π, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è "üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ID"
- –í —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ–π
- –í —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∏–º–µ–Ω–∞

## üöÄ –ó–ê–ü–£–°–ö –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### –®–ê–ì 1: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è backend
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
wget https://raw.githubusercontent.com/your-repo/fix-chat-names-backend.sh
chmod +x fix-chat-names-backend.sh
sudo ./fix-chat-names-backend.sh
```

### –®–ê–ì 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```bash
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
# ‚úÖ Backend —Å–æ–±—Ä–∞–Ω —É—Å–ø–µ—à–Ω–æ
# ‚úÖ Backend –∑–∞–ø—É—â–µ–Ω —á–µ—Ä–µ–∑ PM2
# ‚úÖ API —á–∞—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç: 200
# ‚úÖ API –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —á–∞—Ç–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: 200
# üéâ BACKEND –ò–°–ü–†–ê–í–õ–ï–ù –ò –ì–û–¢–û–í –ö –†–ê–ë–û–¢–ï!
```

### –®–ê–ì 3: –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ frontend (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
```bash
# –ï—Å–ª–∏ frontend –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
wget https://raw.githubusercontent.com/your-repo/fix-client-build-permissions.sh
chmod +x fix-client-build-permissions.sh
sudo ./fix-client-build-permissions.sh
```

## üß™ –ü–†–û–í–ï–†–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–ê

### –í –±—Ä–∞—É–∑–µ—Ä–µ:
```javascript
// ‚úÖ –î–û–õ–ñ–ù–´ –†–ê–ë–û–¢–ê–¢–¨:
‚úì –í —Å–∞–π–¥–±–∞—Ä–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞
‚úì –í –∑–∞–≥–æ–ª–æ–≤–∫–µ —á–∞—Ç–∞ –ø–æ–ª–Ω–æ–µ –∏–º—è —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞
‚úì –ù–∞–¥ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –∏–º–µ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ–π
‚úì –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏

// ‚ùå –ù–ï –î–û–õ–ñ–ù–û –ë–´–¢–¨:
‚úó "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å undefined" –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω—ã—Ö –∏–º–µ–Ω
‚úó –ü—É—Å—Ç—ã–µ –∏–º–µ–Ω–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
‚úó –û—à–∏–±–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
```

### –í –∫–æ–Ω—Å–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞:
```bash
# ‚úÖ –î–û–õ–ñ–ù–´ –†–ê–ë–û–¢–ê–¢–¨:
‚úì npm run build - —Å–±–æ—Ä–∫–∞ –±–µ–∑ –æ—à–∏–±–æ–∫
‚úì pm2 status - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç online
‚úì curl -I http://localhost:3001/api/chats - 200 OK
‚úì curl -I http://localhost:3001/api/chats/1 - 200 OK

# ‚ùå –ù–ï –î–û–õ–ñ–ù–û –ë–´–¢–¨:
‚úó SQL –æ—à–∏–±–∫–∏ —Å NULL –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–µ–π
‚úó API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç undefined –∏–º–µ–Ω–∞
‚úó Backend –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
```

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢

‚úÖ **Backend –∏—Å–ø—Ä–∞–≤–ª–µ–Ω** - SQL –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç NULL
‚úÖ **API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** - –∏–º–µ–Ω–∞ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–æ–≤ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
‚úÖ **Frontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞** - —Å fallback –¥–ª—è –ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
‚úÖ **–ù–µ—Ç –±–æ–ª—å—à–µ "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å undefined"** - –≤—Å–µ –∏–º–µ–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
‚úÖ **–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ** - —á–∞—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω

## üö® –ï–°–õ–ò –ü–†–û–ë–õ–ï–ú–´ –û–°–¢–ê–õ–ò–°–¨

### –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–ª–Ω—É—é –ø–µ—Ä–µ—Å–±–æ—Ä–∫—É:
```bash
# –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç:
wget https://raw.githubusercontent.com/your-repo/nuclear-port-fix.sh
chmod +x nuclear-port-fix.sh
sudo ./nuclear-port-fix.sh
```

### –ò–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤ —Ç–∞–±–ª–∏—Ü–µ users –µ—Å—Ç—å –∏–º–µ–Ω–∞:
SELECT id, first_name, last_name FROM users WHERE first_name IS NULL OR last_name IS NULL;
```

**Backend –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã —Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É —Å "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å undefined"!** üîß
