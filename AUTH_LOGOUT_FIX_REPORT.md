# üîê –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ì–û –í–´–•–û–î–ê –ò–ó –ê–ö–ö–ê–£–ù–¢–ê

## üéØ –ü–†–û–ë–õ–ï–ú–ê:
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤—ã–∫–∏–¥—ã–≤–∞–ª–æ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞ —á–µ—Ä–µ–∑ –Ω–µ–ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∏–∑-–∑–∞ –ø—Ä–æ–±–ª–µ–º —Å JWT —Ç–æ–∫–µ–Ω–∞–º–∏.

## ‚úÖ –ß–¢–û –ò–°–ü–†–ê–í–õ–ï–ù–û:

### 1. **‚è∞ –£–≤–µ–ª–∏—á–µ–Ω–æ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ JWT —Ç–æ–∫–µ–Ω–∞**

**–§–∞–π–ª:** `server/src/routes/auth.ts`

**–ë—ã–ª–æ:** `{ expiresIn: '24h' }` (24 —á–∞—Å–∞)
**–°—Ç–∞–ª–æ:** `{ expiresIn: '7d' }` (7 –¥–Ω–µ–π)

```typescript
const token = jwt.sign(
  { id: user.id, email: user.email, role: user.role },
  JWT_SECRET,
  { expiresIn: '7d' } // 7 –¥–Ω–µ–π –≤–º–µ—Å—Ç–æ 24 —á–∞—Å–æ–≤
);
```

### 2. **üõ°Ô∏è –£–ª—É—á—à–µ–Ω Axios Response Interceptor**

**–§–∞–π–ª:** `client/src/services/api.ts`

**–î–æ–±–∞–≤–ª–µ–Ω—ã —É–ª—É—á—à–µ–Ω–∏—è:**
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ 401 –æ—à–∏–±–æ–∫
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–µ—Ä–µ–¥ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–º
- –ò–∑–±–µ–∂–∞–Ω–∏–µ –ª–∏—à–Ω–∏—Ö —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö –ª–æ–≥–∏–Ω–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

```typescript
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      console.log('Spiritual Platform: –ü–æ–ª—É—á–µ–Ω 401, —Ç–æ–∫–µ–Ω –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω');
      localStorage.removeItem('token');
      // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ª–æ–≥–∏–Ω–∞
      if (window.location.pathname !== '/login' && window.location.pathname !== '/register') {
        window.location.href = '/login';
      }
    }
    return Promise.reject(error);
  }
);
```

### 3. **üîÑ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –≤ AuthContext**

**–§–∞–π–ª:** `client/src/contexts/AuthContext.tsx`

**–£–ª—É—á—à–µ–Ω–∏—è:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ (–∞ –Ω–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ)
- –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ë–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```typescript
useEffect(() => {
  verifyToken();
}, [token]); // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
```

### 4. **‚è±Ô∏è –î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–∞**

**–§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ JWT –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É:**

```typescript
const isTokenExpired = (token: string): boolean => {
  try {
    const payload = JSON.parse(atob(token.split('.')[1]));
    const currentTime = Date.now() / 1000;
    return payload.exp < currentTime;
  } catch (error) {
    return true;
  }
};
```

### 5. **üïê –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞**

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç:**

```typescript
useEffect(() => {
  if (!token) return;

  const checkToken = () => {
    if (isTokenExpired(token)) {
      console.log('Spiritual Platform: –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è logout');
      logout();
    }
  };

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–∞–∑—É
  checkToken();
  
  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
  const interval = setInterval(checkToken, 30 * 60 * 1000);

  return () => clearInterval(interval);
}, [token]);
```

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢:

### ‚úÖ **–†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**

1. **üï∞Ô∏è –î–ª–∏—Ç–µ–ª—å–Ω–∞—è —Å–µ—Å—Å–∏—è:** –¢–æ–∫–µ–Ω —Ç–µ–ø–µ—Ä—å –¥–µ–π—Å—Ç–≤—É–µ—Ç 7 –¥–Ω–µ–π –≤–º–µ—Å—Ç–æ 24 —á–∞—Å–æ–≤
2. **üîç –£–º–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:** –õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è –±–µ–∑ –ª–∏—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–µ—Ä–≤–µ—Ä—É
3. **üìù –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
4. **üõë –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–π logout:** –¢–æ–∫–µ–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç, –∞ –Ω–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ
5. **üö´ –ò–∑–±–µ–∂–∞–Ω–∏–µ —Ü–∏–∫–ª–æ–≤:** –ù–µ—Ç –ª–∏—à–Ω–∏—Ö —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö –ª–æ–≥–∏–Ω–∞

### üîß **–ú–µ—Ö–∞–Ω–∏–∑–º—ã –∑–∞—â–∏—Ç—ã:**

1. **–ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:** –¢–æ–∫–µ–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ –∏—Å—Ç–µ—á–µ–Ω–∏–µ —Å—Ä–æ–∫–∞
2. **–°–µ—Ä–≤–µ—Ä–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è:** JWT –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞:** –ü—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Ç–æ–∫–µ–Ω–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π logout
4. **Graceful handling:** –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï:

### **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ:**

1. **–ó–∞–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å –≤ —Å–∏—Å—Ç–µ–º—É** ‚úÖ
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12):**
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `"Spiritual Platform: –¢–æ–∫–µ–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω"`
3. **–û—Å—Ç–∞–≤—å—Ç–µ –±—Ä–∞—É–∑–µ—Ä –æ—Ç–∫—Ä—ã—Ç—ã–º –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤** ‚úÖ
4. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∞–π—Ç–∞ —á–µ—Ä–µ–∑ –≤—Ä–µ–º—è** ‚úÖ
5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–µ –≤—ã–∫–∏–¥—ã–≤–∞–µ—Ç –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞ –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ** ‚úÖ

### **–õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:**

–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ —Ç–µ–ø–µ—Ä—å –±—É–¥—É—Ç –ø–æ–ª–µ–∑–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:
```
Spiritual Platform: –¢–æ–∫–µ–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
Spiritual Platform: –ü–æ–ª—É—á–µ–Ω 401, —Ç–æ–∫–µ–Ω –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω
Spiritual Platform: –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è logout
```

## üöÄ –ì–û–¢–û–í–û:

**–ü—Ä–æ–±–ª–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã—Ö–æ–¥–∞ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞ —Ä–µ—à–µ–Ω–∞:**
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–æ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞ –¥–æ 7 –¥–Ω–µ–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —É–º–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —á–∞—Å—Ç–æ—Ç–∞ –ø—Ä–æ–≤–µ—Ä–æ–∫ —Ç–æ–∫–µ–Ω–∞

**–°–ï–°–°–ò–Ø –¢–ï–ü–ï–†–¨ –°–¢–ê–ë–ò–õ–¨–ù–ê –ò –î–õ–ò–¢–°–Ø 7 –î–ù–ï–ô! üéâ**
